<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DonutCasino ‚Äî Login</title>
<!-- Correct Supabase Library -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root {
    --frame-border: #11023F;
    --blue: #0052a5;
  }

  *{box-sizing:border-box;margin:0;padding:0;font-family: Arial, Helvetica, sans-serif}

  html, body {
    width:100%;
    height:100%;
    overflow:hidden;
  }

  body {
    background: #0b0b0b;
    display:flex;
    flex-direction:column;
  }

  .center {
    flex:1;
    display:flex;
    flex-direction:column;
    border-radius:12px;
    overflow:hidden;
    background: var(--frame-border);
  }

  header {
    height:70px;
    background: var(--blue);
    display:flex;
    align-items:center;
    justify-content:center;
    border-top-left-radius:12px;
    border-top-right-radius:12px;
  }
  header img{ height:40px; }

  .frame {
    flex:1;
    border-radius:0 0 12px 12px;
    padding:12px;
    overflow:hidden;
    display:flex;
  }

  .bg {
    position:relative;
    flex:1;
    border-radius:12px;
    overflow:hidden;
  }

  .bg img.bg-img {
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
    z-index:0;
    border-radius:12px;
  }

  .content {
    position:relative;
    z-index:2;
    width:100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding-top:8vh;
  }

  .login-box {
    width: 95%;
    max-width: 640px;
    background: rgba(0,0,0,0.2);
    backdrop-filter: blur(6px);
    padding: 60px 70px;
    border-radius: 16px;
    color: #fff;
    text-align:center;
  }

  .login-box h2 {
    font-size: 34px;
    font-weight: 800;
    color: #d9d9d9;
    margin-bottom: 32px;
  }

  input[type="text"] {
    width:100%;
    padding:16px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.05);
    color:#fff;
    font-size:18px;
    margin-bottom:24px;
  }
  input::placeholder { color: rgba(255,255,255,0.6) }

  button.login {
    width:100%;
    padding:16px;
    border-radius:10px;
    border:none;
    background:#00c853;
    color:#fff;
    font-weight:700;
    font-size:18px;
    cursor:pointer;
  }
  button.login:hover { background:#00e676; }

  #message {
    margin-top: 20px;
    padding: 10px;
    border-radius: 8px;
    display: none;
  }
  .success { background: rgba(0, 200, 83, 0.2); color: #00e676; display: block !important; }
  .error { background: rgba(255, 0, 0, 0.2); color: #ff5252; display: block !important; }
  .info { background: rgba(30, 136, 229, 0.2); color: #64b5f6; display: block !important; }

  .player-info {
    margin-top: 20px;
    text-align: left;
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 10px;
    display: none;
  }
  .player-info h3 {
    margin-bottom: 10px;
    color: #00e676;
  }

  @media (max-width:768px) {
    .login-box { padding:40px 25px; }
    .login-box h2 { font-size:24px; }
  }
</style>
</head>
<body>
  <div class="center">
    <header>
      <img src="img/logo.png" alt="DonutCasino Logo">
    </header>

    <div class="frame">
      <div class="bg">
        <img class="bg-img" src="img/background.png" alt="Background">

        <div class="content">
          <div class="login-box">
            <h2>Login to DonutCasino</h2>

            <input type="text" id="minecraftUsername" placeholder="Enter your Minecraft username" />
            <button class="login" onclick="checkPlayer()">LOGIN</button>

            <div id="message"></div>

            <div id="playerInfo" class="player-info">
              <h3>Player Info</h3>
              <p><strong>Username:</strong> <span id="info-username"></span></p>
              <p><strong>Verification Status:</strong> <span id="info-verified"></span></p>
              <p><strong>Balance:</strong> <span id="info-balance"></span> $</p>
              <div id="verification-instruction" style="display: none;">
                <p style="color: #ffeb3b; margin-top: 10px;">To verify yourself, join the server and type: <code>/tpa VerificatoreBot</code></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // üî• REPLACE THESE VALUES WITH YOURS!
    const SUPABASE_URL = 'https://sagzrjcbdtkqhdzdlmmn.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNhZ3pyamNiZHRrcWhkemRsbW1uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxOTA0ODUsImV4cCI6MjA3Mjc2NjQ4NX0.UzADYjRPzXTq8AqvuE13tV9o2nY305bmvY8fpP_AD2c';
    
    // Initialize Supabase
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function showMessage(text, type = 'info') {
      const messageEl = document.getElementById('message');
      messageEl.textContent = text;
      messageEl.className = type;
    }

    function showPlayerInfo(data) {
      const playerInfo = document.getElementById('playerInfo');
      playerInfo.style.display = 'block';
      document.getElementById('info-username').textContent = data.minecraft_username;
      document.getElementById('info-verified').textContent = data.is_verified ? '‚úÖ Verified' : '‚ùå Not verified';
      document.getElementById('info-balance').textContent = data.balance;

      // Show verification instructions if needed
      const verifyInstruction = document.getElementById('verification-instruction');
      verifyInstruction.style.display = data.is_verified ? 'none' : 'block';
    }

    async function checkPlayer() {
      const usernameInput = document.getElementById('minecraftUsername');
      const username = usernameInput.value.trim();
      
      // Reset previous messages
      showMessage('Loading...', 'info');
      document.getElementById('playerInfo').style.display = 'none';

      if (!username) {
        showMessage('Please enter your username.', 'error');
        return;
      }

      try {
        // 1. Search for the player in the database
        const { data: existingPlayer, error: searchError } = await supabase
          .from('players')
          .select('*')
          .eq('minecraft_username', username)
          .maybeSingle();

        if (searchError) throw searchError;

        if (existingPlayer) {
          // 2. Player found!
          showMessage('Login successful!', 'success');
          showPlayerInfo(existingPlayer);
        } else {
          // 3. Player not found ‚Üí create a new one
          const { data: newPlayer, error: insertError } = await supabase
            .from('players')
            .insert([{ 
              minecraft_username: username, 
              balance: 1000 
            }])
            .select()
            .single();

          if (insertError) throw insertError;

          showMessage('New profile created! Welcome! üéâ', 'success');
          showPlayerInfo(newPlayer);
        }

      } catch (error) {
        console.error('Supabase error:', error);
        showMessage('Connection error. Please try again later.', 'error');
      }
    }

    // Allow pressing ENTER to login
    document.getElementById('minecraftUsername').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') checkPlayer();
    });
  </script>
</body>
</html>
